{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/AToMixz/Desktop/NSC/nscno1/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/AToMixz/Desktop/NSC/nscno1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:/Users/AToMixz/Desktop/NSC/nscno1/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/AToMixz/Desktop/NSC/nscno1/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:/Users/AToMixz/Desktop/NSC/nscno1/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:/Users/AToMixz/Desktop/NSC/nscno1/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"C:/Users/AToMixz/Desktop/NSC/nscno1/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:/Users/AToMixz/Desktop/NSC/nscno1/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"C:/Users/AToMixz/Desktop/NSC/nscno1/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"C:\\\\Users\\\\AToMixz\\\\Desktop\\\\NSC\\\\nscno1\\\\pages\\\\metamasklogin.tsx\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from \"react\";\nimport getWeb3 from \"./getWeb3\";\n\nvar App = /*#__PURE__*/function (_Component) {\n  _inherits(App, _Component);\n\n  var _super = _createSuper(App);\n\n  function App() {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      web3: null,\n      accounts: null,\n      challenge: null,\n      signature: null\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getChallenge\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var accounts, res;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              accounts = _this.state.accounts;\n              _context.next = 3;\n              return fetch(\"http://localhost:5001/auth/\".concat(accounts[0]()));\n\n            case 3:\n              res = _context.sent;\n              _context.t0 = _this;\n              _context.next = 7;\n              return res.json();\n\n            case 7:\n              _context.t1 = _context.sent;\n              _context.t2 = {\n                challenge: _context.t1\n              };\n\n              _context.t0.setState.call(_context.t0, _context.t2);\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"signChallenge\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var _this$state, web3, challenge, accounts;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _this$state = _this.state, web3 = _this$state.web3, challenge = _this$state.challenge, accounts = _this$state.accounts;\n              web3.currentProvider.sendAsync({\n                method: \"eth_signTypedData\",\n                params: [challenge, accounts[0]],\n                from: accounts[0]\n              }, function (error, res) {\n                if (error) return console.error(error);\n\n                _this.setState({\n                  signature: res.result\n                });\n              });\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"verifySignature\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var _this$state2, challenge, signature, accounts, res, recovered;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _this$state2 = _this.state, challenge = _this$state2.challenge, signature = _this$state2.signature, accounts = _this$state2.accounts;\n              _context3.next = 3;\n              return fetch(\"http://localhost:5001/auth/\".concat(challenge[1].value, \"/\").concat(signature));\n\n            case 3:\n              res = _context3.sent;\n              _context3.next = 6;\n              return res.text();\n\n            case 6:\n              recovered = _context3.sent;\n\n              if (res.status === 200 && recovered === accounts[0].toLowerCase()) {\n                console.log(\"Signature verified\");\n              } else {\n                console.log(\"Signature not verified\");\n              }\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    })));\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var web3, accounts;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return getWeb3();\n\n              case 2:\n                web3 = _context4.sent;\n                _context4.next = 5;\n                return web3.eth.getAccounts();\n\n              case 5:\n                accounts = _context4.sent;\n                this.setState({\n                  web3: web3,\n                  accounts: accounts\n                });\n\n              case 7:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state3 = this.state,\n          web3 = _this$state3.web3,\n          challenge = _this$state3.challenge,\n          signature = _this$state3.signature;\n      if (!web3) return \"Loading...\";\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"App\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.getChallenge,\n          children: \"Get Challenge\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 53,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.signChallenge,\n          disabled: !challenge,\n          children: \"Sign Challenge\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 54,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: this.verifySignature,\n          disabled: !signature,\n          children: \"Verify Signature\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 57,\n          columnNumber: 9\n        }, this), challenge && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"data\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Challenge\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 63,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n            children: JSON.stringify(challenge, null, 4)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 64,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 11\n        }, this), signature && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"data\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Signature\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n            children: signature\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 71,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["C:/Users/AToMixz/Desktop/NSC/nscno1/pages/metamasklogin.tsx"],"names":["React","Component","getWeb3","App","web3","accounts","challenge","signature","state","fetch","res","json","setState","currentProvider","sendAsync","method","params","from","error","console","result","value","text","recovered","status","toLowerCase","log","eth","getAccounts","getChallenge","signChallenge","verifySignature","JSON","stringify"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport getWeb3 from \"./getWeb3\";\r\nclass App extends Component {\r\n  state = { web3: null, accounts: null, challenge: null, signature: null };\r\n\r\n  async componentDidMount() {\r\n    const web3 = await getWeb3();\r\n    const accounts = await web3.eth.getAccounts();\r\n    this.setState({ web3, accounts });\r\n  }\r\n\r\n  getChallenge = async () => {\r\n    const { accounts } = this.state;\r\n    const res = await fetch(\r\n      `http://localhost:5001/auth/${accounts[0]()}`\r\n    );\r\n    this.setState({ challenge: await res.json() });\r\n  };\r\n\r\n  signChallenge = async () => {\r\n    const { web3, challenge, accounts } = this.state;\r\n    web3.currentProvider.sendAsync(\r\n      {\r\n        method: \"eth_signTypedData\",\r\n        params: [challenge, accounts[0]],\r\n        from: accounts[0]\r\n      },\r\n      (error, res) => {\r\n        if (error) return console.error(error);\r\n        this.setState({ signature: res.result });\r\n      }\r\n    );\r\n  };\r\n\r\n  verifySignature = async () => {\r\n    const { challenge, signature, accounts } = this.state;\r\n    const res = await fetch(\r\n      `http://localhost:5001/auth/${challenge[1].value}/${signature}`\r\n    );\r\n    const recovered = await res.text();\r\n    if (res.status === 200 && recovered === accounts[0].toLowerCase()) {\r\n      console.log(\"Signature verified\");\r\n    } else {\r\n      console.log(\"Signature not verified\");\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { web3, challenge, signature } = this.state;\r\n    if (!web3) return \"Loading...\";\r\n    return (\r\n      <div className=\"App\">\r\n        <button onClick={this.getChallenge}>Get Challenge</button>\r\n        <button onClick={this.signChallenge} disabled={!challenge}>\r\n          Sign Challenge\r\n        </button>\r\n        <button onClick={this.verifySignature} disabled={!signature}>\r\n          Verify Signature\r\n        </button>\r\n\r\n        {challenge && (\r\n          <div className=\"data\">\r\n            <h2>Challenge</h2>\r\n            <pre>{JSON.stringify(challenge, null, 4)}</pre>\r\n          </div>\r\n        )}\r\n\r\n        {signature && (\r\n          <div className=\"data\">\r\n            <h2>Signature</h2>\r\n            <pre>{signature}</pre>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}